import { parseDictionary } from "./parser.ts";

const SOURCE = new URL("./dictionary", import.meta.url);
const DESTINATION = new URL("./dictionary.ts", import.meta.url);

export async function build(checkFile: boolean): Promise<void> {
  const text = await Deno.readTextFile(SOURCE);
  if (checkFile) {
    let current: undefined | string;
    try {
      const { original } = await import("./dictionary.ts");
      current = original;
    } catch (_) {
      // pass
    }
    if (text === current) {
      return;
    }
  }
  console.log("Building dictionary...");
  const json = JSON.stringify(parseDictionary(text), undefined, 2);
  const original = JSON.stringify(text);
  const code = `\
// This code is autogenerated

import { Dictionary } from "./type.ts";

export const dictionary: Dictionary = ${json};

export const original = ${original};
`;
  await Deno.writeTextFile(DESTINATION, code);
}
if (import.meta.main) {
  await build(true);
}
